(self.webpackChunkrestaurant_manager=self.webpackChunkrestaurant_manager||[]).push([[140],{1140:function(e,t,s){"use strict";s.r(t),s.d(t,{UserModul:function(){return ve}});var r=s(8583),i=s(3679),o=s(1095),a=s(3738),n=s(7539),u=s(2458),l=s(2238),c=s(6627),d=s(9983),m=s(2613),p=s(7441),h=s(4436),g=s(6458),f=s(5987),Z=s(1601),v=s(3065),U=s(7574),q=s(5319),A=s(721),w=s(6667),b=s(6878);const N=(0,s(273).H)({selectId:e=>e.id}),T=N.getInitialState(),_=(0,v.Lq)(T,(0,v.on)(b.O4,(e,t)=>N.addMany(t.users,e)),(0,v.on)(b.UU,(e,t)=>N.removeOne(t.id,e)),(0,v.on)(b._k,(e,t)=>N.addOne(t.user,e)),(0,v.on)(b.qB,(e,t)=>{return N.updateOne({id:(s=t.user).id,changes:s},e);var s}),(0,v.on)(b.dy,(e,t)=>Object.assign(Object.assign({},e),{selectedUserId:t.id})));function k(e=T,t){return _(e,t)}const F=(0,v.ZF)("user"),I=(0,v.P1)(F,e=>e.ids),y=(0,v.P1)(F,e=>e.entities),x=(0,v.P1)(I,y,(e,t)=>e.map(e=>t[e]).map(e=>({id:e.id,email:e.email,name:`${e.firstName} ${e.lastName}`}))),Y=((0,v.P1)(F,y,(e,t)=>{var s;return null!==(s=t[e.selectedUserId])&&void 0!==s?s:null}),e=>(0,v.P1)(y,t=>t[e]));var J=s(7716),C=s(8295);function O(e,t){1&e&&(J.TgZ(0,"span"),J._uU(1,"New User"),J.qZA())}function E(e,t){1&e&&(J.TgZ(0,"span"),J._uU(1,"Edit User"),J.qZA())}function D(e,t){1&e&&(J.TgZ(0,"mat-error"),J._uU(1," Email is "),J.TgZ(2,"strong"),J._uU(3,"required"),J.qZA(),J.qZA())}function Q(e,t){1&e&&(J.TgZ(0,"mat-error"),J._uU(1," First name is "),J.TgZ(2,"strong"),J._uU(3,"required"),J.qZA(),J.qZA())}function S(e,t){1&e&&(J.TgZ(0,"mat-error"),J._uU(1," Surname is "),J.TgZ(2,"strong"),J._uU(3,"required"),J.qZA(),J.qZA())}function $(e,t){1&e&&(J.TgZ(0,"mat-error"),J._uU(1," Password is "),J.TgZ(2,"strong"),J._uU(3,"required"),J.qZA(),J.qZA())}function R(e,t){if(1&e&&(J.TgZ(0,"mat-form-field",7),J.TgZ(1,"mat-label"),J._uU(2,"Password"),J.qZA(),J._UZ(3,"input",18),J.YNc(4,$,4,0,"mat-error",2),J.qZA()),2&e){const e=J.oxw();J.xp6(4),J.Q6J("ngIf",e.userForm.controls.password.hasError("required"))}}function G(e,t){1&e&&(J.TgZ(0,"mat-error"),J._uU(1," Verify password is "),J.TgZ(2,"strong"),J._uU(3,"required"),J.qZA(),J.qZA())}function P(e,t){1&e&&(J.TgZ(0,"mat-error"),J._uU(1," Verified password "),J.TgZ(2,"strong"),J._uU(3,"has to be same"),J.qZA(),J._uU(4," as Password "),J.qZA())}function B(e,t){if(1&e&&(J.TgZ(0,"mat-form-field",7),J.TgZ(1,"mat-label"),J._uU(2,"Verify password"),J.qZA(),J._UZ(3,"input",19),J.YNc(4,G,4,0,"mat-error",2),J.YNc(5,P,5,0,"mat-error",2),J.qZA()),2&e){const e=J.oxw();J.xp6(4),J.Q6J("ngIf",e.userForm.controls.passwordCheck.hasError("required")),J.xp6(1),J.Q6J("ngIf",e.userForm.controls.passwordCheck.hasError("differentPassword"))}}function L(e,t){if(1&e&&(J.TgZ(0,"mat-option",20),J._uU(1),J.qZA()),2&e){const e=t.$implicit;J.Q6J("value",e.id.toLowerCase()),J.xp6(1),J.hij(" ",e.text," ")}}function V(e,t){1&e&&(J.TgZ(0,"mat-error"),J._uU(1," Restaurant is "),J.TgZ(2,"strong"),J._uU(3,"required"),J.qZA(),J.qZA())}function j(e,t){if(1&e&&(J.TgZ(0,"mat-option",20),J._uU(1),J.qZA()),2&e){const e=t.$implicit;J.Q6J("value",e.id),J.xp6(1),J.hij(" ",e.text," ")}}function M(e,t){1&e&&(J.TgZ(0,"mat-error"),J._uU(1," User role is "),J.TgZ(2,"strong"),J._uU(3,"required"),J.qZA(),J.qZA())}function W(e,t){if(1&e){const e=J.EpF();J.TgZ(0,"div"),J.TgZ(1,"button",17),J.NdJ("click",function(){return J.CHM(e),J.oxw().changePassword()}),J._uU(2," Change password "),J.qZA(),J.qZA()}}let X=(()=>{class e{constructor(e,t,s,r){this.formBuilder=e,this.location=t,this.store=s,this.route=r,this.subscriptions=new q.w}ngOnDestroy(){this.subscriptions.unsubscribe()}ngOnInit(){this.userForm=this.formBuilder.group({email:new i.NI("",[i.kI.required,i.kI.email]),firstName:new i.NI("",[i.kI.required]),lastName:new i.NI("",[i.kI.required]),phone:new i.NI(""),restaurant:new i.NI("",[i.kI.required]),role:new i.NI("",[i.kI.required])}),this.subscriptions.add(this.store.select(Y(this.route.snapshot.params.id)).subscribe(e=>{var t,s,r,o,a,n;e?this.isEdit=!0:(this.isEdit=!1,this.userForm.addControl("password",new i.NI("",[i.kI.required,i.kI.minLength(6)])),this.userForm.addControl("passwordCheck",new i.NI("",[i.kI.required]))),this.user=e,this.userForm.controls.email.setValue(null===(t=this.user)||void 0===t?void 0:t.email),this.userForm.controls.firstName.setValue(null===(s=this.user)||void 0===s?void 0:s.firstName),this.userForm.controls.lastName.setValue(null===(r=this.user)||void 0===r?void 0:r.lastName),this.userForm.controls.phone.setValue(null===(o=this.user)||void 0===o?void 0:o.phone),this.userForm.controls.restaurant.setValue(null===(a=this.user)||void 0===a?void 0:a.restaurantId),this.userForm.controls.role.setValue(`${null===(n=this.user)||void 0===n?void 0:n.userRole}`)})),this.subscriptions.add(this.store.select(w.eG).subscribe(e=>{this.restaurantsComboItems=e})),this.subscriptions.add(this.store.select(A.Jm).subscribe(e=>{this.userRoles=e.map(e=>({value:e.userRole,text:e.userRole.toString().toLowerCase()}))}))}navigateBack(){this.location.back()}onSubmit(){var e,t;if(!this.userForm.invalid)if(this.isEdit){const t={id:null===(e=this.user)||void 0===e?void 0:e.id,email:this.userForm.controls.email.value,firstName:this.userForm.controls.firstName.value,lastName:this.userForm.controls.lastName.value,phone:this.userForm.controls.phone.value,restaurantId:this.userForm.controls.restaurant.value,userRoleId:this.userForm.controls.role.value};this.store.dispatch((0,b.Nq)({user:t}))}else{if(this.userForm.controls.password.value!==this.userForm.controls.passwordCheck.value)return void this.userForm.controls.passwordCheck.setErrors({differentPassword:!0});const e={id:null===(t=this.user)||void 0===t?void 0:t.id,email:this.userForm.controls.email.value,firstName:this.userForm.controls.firstName.value,lastName:this.userForm.controls.lastName.value,phone:this.userForm.controls.phone.value,password:this.userForm.controls.password.value,restaurantId:this.userForm.controls.restaurant.value,userRoleId:this.userForm.controls.role.value};this.store.dispatch((0,b.a$)({user:e}))}}changePassword(){}}return e.\u0275fac=function(t){return new(t||e)(J.Y36(i.qu),J.Y36(r.Ye),J.Y36(v.yh),J.Y36(f.gz))},e.\u0275cmp=J.Xpm({type:e,selectors:[["app-edit-user"]],decls:46,vars:13,consts:[[1,"edit-form-container"],[1,"header"],[4,"ngIf"],[3,"formGroup"],[1,"input-full-width"],["type","email","matInput","","placeholder","Email","formControlName","email"],["type","text","matInput","","placeholder","First name","formControlName","firstName"],["color","primary-text",1,"input-full-width"],["type","text","matInput","","placeholder","Surname","formControlName","lastName"],["type","tel","matInput","","placeholder","Phone","formControlName","phone"],["class","input-full-width","color","primary-text",4,"ngIf"],["placeholder","Select user restaurant","formControlName","restaurant"],["value","","disabled",""],[3,"value",4,"ngFor","ngForOf"],["placeholder","Select user role","formControlName","role"],[1,"actions"],["mat-button","",1,"back-button",3,"click"],["mat-button","",1,"primary-button",3,"click"],["type","password","matInput","","placeholder","Password","formControlName","password"],["type","password","matInput","","placeholder","Verify password","formControlName","passwordCheck"],[3,"value"]],template:function(e,t){1&e&&(J.TgZ(0,"div",0),J.TgZ(1,"div",1),J.YNc(2,O,2,0,"span",2),J.YNc(3,E,2,0,"span",2),J.qZA(),J.TgZ(4,"form",3),J.TgZ(5,"mat-form-field",4),J.TgZ(6,"mat-label"),J._uU(7,"Email"),J.qZA(),J._UZ(8,"input",5),J.YNc(9,D,4,0,"mat-error",2),J.qZA(),J.TgZ(10,"mat-form-field",4),J.TgZ(11,"mat-label"),J._uU(12,"First name"),J.qZA(),J._UZ(13,"input",6),J.YNc(14,Q,4,0,"mat-error",2),J.qZA(),J.TgZ(15,"mat-form-field",7),J.TgZ(16,"mat-label"),J._uU(17,"Surname"),J.qZA(),J._UZ(18,"input",8),J.YNc(19,S,4,0,"mat-error",2),J.qZA(),J.TgZ(20,"mat-form-field",7),J.TgZ(21,"mat-label"),J._uU(22,"Phone"),J.qZA(),J._UZ(23,"input",9),J.qZA(),J.YNc(24,R,5,1,"mat-form-field",10),J.YNc(25,B,6,2,"mat-form-field",10),J.TgZ(26,"mat-form-field",4),J.TgZ(27,"mat-select",11),J.TgZ(28,"mat-option",12),J._uU(29,"Choose restaurant"),J.qZA(),J.YNc(30,L,2,2,"mat-option",13),J.qZA(),J.YNc(31,V,4,0,"mat-error",2),J.qZA(),J.TgZ(32,"mat-form-field",4),J.TgZ(33,"mat-select",14),J.TgZ(34,"mat-option",12),J._uU(35,"Choose role"),J.qZA(),J.YNc(36,j,2,2,"mat-option",13),J.qZA(),J.YNc(37,M,4,0,"mat-error",2),J.qZA(),J.YNc(38,W,3,0,"div",2),J.TgZ(39,"div",15),J.TgZ(40,"button",16),J.NdJ("click",function(){return t.navigateBack()}),J.TgZ(41,"mat-icon"),J._uU(42,"arrow_back"),J.qZA(),J._uU(43," Back "),J.qZA(),J.TgZ(44,"button",17),J.NdJ("click",function(){return t.onSubmit()}),J._uU(45," Save "),J.qZA(),J.qZA(),J.qZA(),J.qZA()),2&e&&(J.xp6(2),J.Q6J("ngIf",!t.isEdit),J.xp6(1),J.Q6J("ngIf",t.isEdit),J.xp6(1),J.Q6J("formGroup",t.userForm),J.xp6(5),J.Q6J("ngIf",t.userForm.controls.email.hasError("required")),J.xp6(5),J.Q6J("ngIf",t.userForm.controls.firstName.hasError("required")),J.xp6(5),J.Q6J("ngIf",t.userForm.controls.lastName.hasError("required")),J.xp6(5),J.Q6J("ngIf",!t.isEdit),J.xp6(1),J.Q6J("ngIf",!t.isEdit),J.xp6(5),J.Q6J("ngForOf",t.restaurantsComboItems),J.xp6(1),J.Q6J("ngIf",t.userForm.controls.restaurant.hasError("required")),J.xp6(5),J.Q6J("ngForOf",t.userRoles),J.xp6(1),J.Q6J("ngIf",t.userForm.controls.role.hasError("required")),J.xp6(1),J.Q6J("ngIf",t.isEdit))},directives:[r.O5,i._Y,i.JL,i.sg,C.KE,C.hX,d.Nt,i.Fj,i.JJ,i.u,p.gD,u.ey,r.sg,o.lW,c.Hw,C.TO],styles:[""]}),e})();var z=s(5917),K=s(3190),H=s(8002),ee=s(5304),te=s(2340),se=s(3975),re=s(2232),ie=s(1841),oe=s(446);let ae=(()=>{class e{constructor(e,t,s){this.actions$=e,this.http=t,this.snackbarService=s,this.loadRestaurantUsers$=(0,Z.GW)(()=>this.actions$.pipe((0,Z.l4)(b.xz),(0,K.w)(e=>this.http.get(`${this.baseUrl}GetListOfRestaurantUsers`).pipe((0,H.U)(e=>(0,b.O4)({users:e.data})),(0,ee.K)(e=>(0,z.of)((0,re.Ey)({error:e.error.Message,msg:"Load restaurant users failed",action:"loadRestaurantUsers"}))))))),this.deleteUser$=(0,Z.GW)(()=>this.actions$.pipe((0,Z.l4)(b.h8),(0,K.w)(e=>this.http.delete(`${this.baseUrl}DeleteUser?id=${e.id}`).pipe((0,H.U)(t=>(this.snackbarService.showMessage("Successfull delete","deleteUser",se.C.Success),e.successCallback(),(0,b.UU)({id:e.id}))),(0,ee.K)(e=>(0,z.of)((0,re.Ey)({error:e.error.Message,msg:"Delete failed",action:"deleteUser"}))))))),this.registerUser$=(0,Z.GW)(()=>this.actions$.pipe((0,Z.l4)(b.a$),(0,K.w)(e=>this.http.post(`${this.baseUrl}Register`,e.user).pipe((0,H.U)(e=>(this.snackbarService.showMessage("User registered","registerUser",se.C.Success),(0,b._k)({user:e.data}))),(0,ee.K)(e=>(0,z.of)((0,re.Ey)({error:e.error.Message,msg:"Registration failed",action:"registerUser"}))))))),this.updateUser$=(0,Z.GW)(()=>this.actions$.pipe((0,Z.l4)(b.Nq),(0,K.w)(e=>this.http.patch(`${this.baseUrl}UpdateUser`,e.user).pipe((0,H.U)(e=>(this.snackbarService.showMessage("User updated","updateUser",se.C.Success),(0,b.qB)({user:e.data}))),(0,ee.K)(e=>(0,z.of)((0,re.Ey)({error:e.error.Message,msg:"Update failed",action:"updateUser"}))))))),this.baseUrl=`${te.N.apiUrl}/api/User/`}}return e.\u0275fac=function(t){return new(t||e)(J.LFG(Z.eX),J.LFG(ie.eN),J.LFG(oe.c))},e.\u0275prov=J.Yz7({token:e,factory:e.\u0275fac}),e})();var ne=s(6287),ue=s(3997),le=s(5136);let ce=(()=>{class e{constructor(e,t,s,r,i,o){this.router=e,this.route=t,this.location=s,this.dialog=r,this.baseService=i,this.store=o,this.subscriptions=new q.w}ngOnDestroy(){this.subscriptions.unsubscribe()}ngOnInit(){this.subscriptions.add(this.store.select(Y(this.route.snapshot.params.id)).subscribe(e=>{this.userDetail=e}))}navigateBack(){this.location.back()}deleteUser(){this.dialog.open(ue.S,{width:"300px",data:{message:"Delete user"},autoFocus:!1}).afterClosed().subscribe(e=>{void 0!==e&&!0===e&&this.store.dispatch((0,b.h8)({id:this.userDetail.id,successCallback:this.baseService.navigateBackWithTimeout}))})}editUser(){this.router.navigate(["/users/edit",this.userDetail.id])}}return e.\u0275fac=function(t){return new(t||e)(J.Y36(f.F0),J.Y36(f.gz),J.Y36(r.Ye),J.Y36(l.uw),J.Y36(le.b),J.Y36(v.yh))},e.\u0275cmp=J.Xpm({type:e,selectors:[["app-user-detail"]],decls:18,vars:4,consts:[[1,"detail-header"],[1,"detail-image"],["matRipple","",3,"click"],["src","./assets/images/image_not_found2.jpg"],[1,"detail-description"],[1,"name"],[1,"description"],[1,"actions"],["mat-button","",1,"danger-button",3,"click"],["mat-button","",1,"primary-button",3,"click"]],template:function(e,t){1&e&&(J._UZ(0,"div",0),J.TgZ(1,"div",1),J.TgZ(2,"mat-icon",2),J.NdJ("click",function(){return t.navigateBack()}),J._uU(3,"keyboard_backspace"),J.qZA(),J._UZ(4,"img",3),J.qZA(),J.TgZ(5,"div",4),J.TgZ(6,"div",5),J.TgZ(7,"span"),J._uU(8),J.qZA(),J.qZA(),J.TgZ(9,"div",6),J._uU(10),J.qZA(),J.TgZ(11,"div",6),J._uU(12),J.qZA(),J.TgZ(13,"div",7),J.TgZ(14,"button",8),J.NdJ("click",function(){return t.deleteUser()}),J._uU(15," Delete user "),J.qZA(),J.TgZ(16,"button",9),J.NdJ("click",function(){return t.editUser()}),J._uU(17," Edit user "),J.qZA(),J.qZA(),J.qZA()),2&e&&(J.xp6(8),J.AsE("",null==t.userDetail?null:t.userDetail.firstName," ",null==t.userDetail?null:t.userDetail.lastName,""),J.xp6(2),J.Oqu(null==t.userDetail?null:t.userDetail.email),J.xp6(2),J.Oqu(null==t.userDetail?null:t.userDetail.phone))},directives:[c.Hw,u.wG,o.lW],styles:[".body-content{margin:0!important}.actions{display:flex;justify-content:space-around}"],encapsulation:2}),e})(),de=(()=>{class e{constructor(e,t){this.router=e,this.store=t}ngOnInit(){}openDetail(e){this.router.navigate(["/users/detail",e])}}return e.\u0275fac=function(t){return new(t||e)(J.Y36(f.F0),J.Y36(v.yh))},e.\u0275cmp=J.Xpm({type:e,selectors:[["app-user-item"]],inputs:{user:"user"},decls:10,vars:2,consts:[["matRipple","",1,"list-item-content",3,"click"],[1,"list-item-header"],[1,"list-item-name"],[1,"offer-item-price"],[1,"price"]],template:function(e,t){1&e&&(J.TgZ(0,"div",0),J.NdJ("click",function(){return t.openDetail(t.user.id)}),J.TgZ(1,"div",1),J.TgZ(2,"div"),J.TgZ(3,"div"),J.TgZ(4,"h3",2),J._uU(5),J.qZA(),J.qZA(),J.TgZ(6,"div",3),J.TgZ(7,"span",4),J._uU(8),J.qZA(),J._uU(9," \xa0 "),J.qZA(),J.qZA(),J.qZA(),J.qZA()),2&e&&(J.xp6(5),J.hij(" ",t.user.name," "),J.xp6(3),J.Oqu(t.user.email))},directives:[u.wG],styles:[""]}),e})(),me=(()=>{class e{transform(e,t){return e.sort(t.nameAsc?(e,t)=>e.name<t.name?1:e.name>t.name?-1:0:(e,t)=>e.name>t.name?1:e.name<t.name?-1:0),e}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=J.Yjl({name:"userSort",type:e,pure:!0}),e})();function pe(e,t){1&e&&(J.TgZ(0,"mat-icon"),J._uU(1,"arrow_drop_down"),J.qZA())}function he(e,t){1&e&&(J.TgZ(0,"mat-icon"),J._uU(1,"arrow_drop_up"),J.qZA())}function ge(e,t){1&e&&J._UZ(0,"app-user-item",6),2&e&&J.Q6J("user",t.$implicit)}const fe=function(e){return{nameAsc:e}},Ze=[{path:"",component:(()=>{class e{constructor(e,t){this.router=e,this.store=t,this.subscriptions=new q.w,this.sortAscDesc=!0}ngOnDestroy(){this.subscriptions.unsubscribe()}ngOnInit(){this.store.dispatch((0,b.xz)()),this.store.dispatch((0,b.dy)({id:void 0})),this.subscriptions.add(this.store.select(x).subscribe(e=>{this.users=e}))}addNewUser(){this.router.navigate(["/users/add"])}sortUsers(){this.sortAscDesc=!this.sortAscDesc}}return e.\u0275fac=function(t){return new(t||e)(J.Y36(f.F0),J.Y36(v.yh))},e.\u0275cmp=J.Xpm({type:e,selectors:[["app-user"]],decls:14,vars:8,consts:[[1,"restaurant-content"],[1,"header-container"],["matRipple","",1,"sort-item",3,"click"],[4,"ngIf"],["mat-button","",1,"base-button",3,"click"],[3,"user",4,"ngFor","ngForOf"],[3,"user"]],template:function(e,t){1&e&&(J.TgZ(0,"div",0),J.TgZ(1,"div",1),J.TgZ(2,"div",2),J.NdJ("click",function(){return t.sortUsers()}),J.TgZ(3,"span"),J._uU(4,"Name"),J.qZA(),J._uU(5," \xa0 "),J.YNc(6,pe,2,0,"mat-icon",3),J.YNc(7,he,2,0,"mat-icon",3),J.qZA(),J.TgZ(8,"button",4),J.NdJ("click",function(){return t.addNewUser()}),J._uU(9," New \xa0"),J.TgZ(10,"mat-icon"),J._uU(11,"add"),J.qZA(),J.qZA(),J.qZA(),J.YNc(12,ge,1,1,"app-user-item",5),J.ALo(13,"userSort"),J.qZA()),2&e&&(J.xp6(6),J.Q6J("ngIf",t.sortAscDesc),J.xp6(1),J.Q6J("ngIf",!t.sortAscDesc),J.xp6(5),J.Q6J("ngForOf",J.xi3(13,3,t.users,J.VKq(6,fe,t.sortAscDesc))))},directives:[u.wG,r.O5,o.lW,c.Hw,r.sg,de],pipes:[me],styles:[""]}),e})()},{path:"add",component:X,canActivate:[U.a],resolve:{result:ne.O},runGuardsAndResolvers:"always"},{path:"edit/:id",component:X,canActivate:[U.a],resolve:{result:ne.O},runGuardsAndResolvers:"always"},{path:"detail/:id",component:ce,canActivate:[U.a],resolve:{result:ne.O},runGuardsAndResolvers:"always"}];let ve=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=J.oAB({type:e}),e.\u0275inj=J.cJS({providers:[ne.O],imports:[[v.Aw.forFeature("user",k),Z.sQ.forFeature([ae]),f.Bz.forChild(Ze),r.ez,i.u5,p.LD,m.Fk,i.UX,n.p9,l.Is,h.KP,c.Ps,o.ot,a.QW,d.c,u.si,g.ZX]]}),e})()}}]);